<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>

      <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="http://i.gtimg.cn/qzone/biz/gdt/lib/jquery/jquery-2.1.4.js?max_age=31536000"></script>



  <script>

  

  $(function(){  

    $('#upLoad').on('change',function(){  

        var filePath = $(this).val(),         //获取到input的value，里面是文件的路径  

            fileFormat = filePath.substring(filePath.lastIndexOf(".")).toLowerCase(),  

            imgBase64 = '',      //存储图片的imgBase64  

            fileObj = document.getElementById('upLoad').files[0]; //上传文件的对象,要这样写才行，用jquery写法获取不到对象  

              

        // 检查是否是图片  

        if( !fileFormat.match(/.png|.jpg|.jpeg/) ) {  

            alert('上传错误,文件格式必须为：png/jpg/jpeg');  

            return;    

        }  

  

        // 调用函数，对图片进行压缩  

        compress(fileObj,function(imgBase64){  

            imgBase64 = imgBase64;    //存储转换的base64编码  

            $('#viewImg').attr('src',imgBase64); //显示预览图片  

        });  

    });  

  

     // 不对图片进行压缩，直接转成base64  

    function directTurnIntoBase64(fileObj,callback){  

        var r = new FileReader();  

        // 转成base64  

        r.onload = function(){  

           //变成字符串  

            imgBase64 = r.result;  

            console.log(imgBase64);  

            callback(imgBase64);  

        }  

        r.readAsDataURL(fileObj);    //转成Base64格式  

    }  

  

       // 对图片进行压缩  

    function compress(fileObj, callback) {   

        if ( typeof (FileReader) === 'undefined') {    

            console.log("当前浏览器内核不支持base64图标压缩");    

            //调用上传方式不压缩    

            directTurnIntoBase64(fileObj,callback);  

        } else {    

            try {      

                var reader = new FileReader();    

                reader.onload = function (e) {    

                    var image = $('<img/>');    

                    image.load(function(){    

                        square = 700,   //定义画布的大小，也就是图片压缩之后的像素  

                        canvas = document.createElement('canvas'),   

                        context = canvas.getContext('2d'),  

                        imageWidth = 0,    //压缩图片的大小  

                        imageHeight = 0,   

                        offsetX = 0,   

                        offsetY = 0,  

                        data = '';   

  

                        canvas.width = square;    

                        canvas.height = square;   

                        context.clearRect(0, 0, square, square);     

  

                        if (this.width > this.height) {    

                            imageWidth = Math.round(square * this.width / this.height);    

                            imageHeight = square;    

                            offsetX = - Math.round((imageWidth - square) / 2);    

                        } else {    

                            imageHeight = Math.round(square * this.height / this.width);    

                            imageWidth = square;    

                            offsetY = - Math.round((imageHeight - square) / 2);    

                        }    

                        context.drawImage(this, offsetX, offsetY, imageWidth, imageHeight);    

                        var data = canvas.toDataURL('image/jpeg');    

                        //压缩完成执行回调    

                         callback(data);    

                    });    

                    image.attr('src', e.target.result);    

                };    

                reader.readAsDataURL(fileObj);    

            }catch(e){    

                console.log("压缩失败!");    

                //调用直接上传方式  不压缩   

                directTurnIntoBase64(fileObj,callback);   

            }    

        }  

    }  

});  

  

 </script>

<style type="text/css">a {text-decoration: none}</style>
      <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
   .F1{
    background:#3e77c8;
    color:#ffffff;
    text-align: center;
    font-size: 23px;
    font-weight:400;
    height: 80px;
    line-height: 90px;
    position:relative;
  }
  .Fp{

    background:#f3f2f5;

    color:#696969;

    line-height: 40px;

    height: 10px;

  }
  .F2{

    background:#fffeff;

    color:#696969;

    font-weight: 1000;

    line-height: 40px;

    height: 40px;

  }

  .F3{

    background:#f3f2f5;

    color:#696969;

    line-height: 40px;

    height: 10px;

  }

  .F4{

    background:#fffeff;

    color:#696969;

    font-weight: 1000;

    line-height: 43px;

    height: 40px;

  }
  .F5{

    background:#f3f2f5;

    color:#696969;

    line-height: 40px;

    height: 10px;

  }



  .F6{
    background:#f5f6f8;
    color:#96979c;

    font-weight: 900;
    line-height: 40px;
    height: 40px;
  }  
  .F7{
    background:#ffffff;

    color:#535456;

    font-size: 60px;

    font-weight: 400;

    line-height: 70px;

    height: 70px;

  }  

  .F77{
    background:#ffffff;

    color:#535456;

    font-size: 60px;

    font-weight: 400;

    line-height: 70px;

    height: 70px;

  }  

  .F8{

    background:#f5f6f8;

    color:#96979c;

    font-weight: 900;
    line-height: 40px;

    height: 40px;

  }  

  .F9{

    background:#ffffff;

    color:#696969;

    line-height: 112px;

    height: 315px;

  }

  .F10{

    background:#f5f6f8;

    color:#96979c;

    font-weight: 900;
       line-height: 40px;

    height: 40px;

  }  

  .F11{

    background:#ffffff;

    color:#696969;

       line-height: 220px;

    height: 220px;

  }  


  .F12{

    background:#f5f6f8;

    color:#96979c;

    font-weight: 900;
    line-height: 40px;

    height: 40px;

  }

  .F13{

    background:#ffffff;

    color:#111111;

    font-size: 10px;
    font-weight: 800;
    line-height: 10px;
    height: 40px;

  }
  textarea{
    border:none;
　　width：200px;
    height:80px;
　　box-radius:25%;
　　outline:medium;
　　text-align:center;

    font-weight: 700;
    font-size:20px;
    line-height: 50px;
    font-weight: 900;
}
</style>

</head>
<body link="fff">

  <div class=F1>

      <img align="left" src="./img/X.jpg" width="70" >

 学生返校后日常通行码

      <img align="right" src="./img/dot.jpg" width="35">

  </div>

  <div class=Fp>&nbsp;&nbsp;&nbsp;</div>
  <div class=F2>

      当前部门：信息科学与工程学部
      <img align="left" src="./img/1.jpg" width="35" >

  </div>

  <div class=F3>&nbsp;&nbsp;&nbsp;</div>
  <div class=F4>
      学生返校后通行码
      <img align="left" src="./img/2.jpg" width="35" >
    </div>
  <div class=F5>&nbsp;&nbsp;&nbsp;</div>

  <div class=F6>&nbsp;&nbsp;&nbsp;扫码时间</div>



  <div class=F7></div>

    <script>

        function getTime1() {

            var date = new Date();

            var year = date.getFullYear(); //获取年份

            var month = date.getMonth() + 1; //获取月份

            month = month < 10 ? '0' + month : month;

            var day = date.getDate(); //获取日期

            var hour = date.getHours(); //获取小时

            hour = hour < 10 ? '0' + hour : hour;

            var minute = date.getMinutes(); // 获取分

            minute = minute < 10 ? '0' + minute : minute;

            return '&nbsp;'+year + '-' + month + '-' + day  ;

        }
        setInterval(function() {

            document.querySelector('.F7').innerHTML = getTime1();

        }, 1000)

    </script>


  <div class=F77></div>

    <script>

        function getTime2() {

            var date = new Date();

            var year = date.getFullYear(); //获取年份

            var month = date.getMonth() + 1; //获取月份

            month = month < 10 ? '0' + month : month;

            var day = date.getDate(); //获取日期

            var hour = date.getHours(); //获取小时

            hour = hour < 10 ? '0' + hour : hour;

            var minute = date.getMinutes(); // 获取分

            minute = minute < 10 ? '0' + minute : minute;
            return '&nbsp;'+ hour + ':' + minute ;

        }
        setInterval(function() {

            document.querySelector('.F77').innerHTML = getTime2();

        }, 1000)

    </script>



  <div class=F8>&nbsp;&nbsp;&nbsp;通行码</div>

  <div class=F9 align="center"><img style="position:relative;top: 8px;" src="./img/code.gif" width="300"></div>


  <div class=F10>&nbsp;&nbsp;&nbsp;头像</div>

  <div class=F11 align="center">

      <div id='previewImg' align="center" style="height: 220px;">  

        <img src="" id='viewImg' width="150" height="200" style="position:relative;top: 8px;"/>  

    </div> 
  </div>



  <div class=F12>&nbsp;&nbsp;&nbsp;姓名，学院，通行门</div>
  <div class=F13>
    <br/>
    <textarea type="text" style="height:100px;width:400px;" >吕如因，信息科学与工程学部，鱼山四校门（学生） 入</textarea>
    
    <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
    <input type="file" id="upLoad" name="image" >  

    <!-- 显示上传之后的图片 -->  
</body>

</html>

